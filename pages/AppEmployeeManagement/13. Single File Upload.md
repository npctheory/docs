---
title: 13. File Upload
layout: page
parent: DemoAppMvc
nav_order: 13
---

##### ./Mvc/ViewModels/EmployeeCreateViewModel.cs  
```csharp
using System.ComponentModel.DataAnnotations;

public class EmployeeCreateViewModel
{
    [Required]
    [MaxLength(50,ErrorMessage ="Name cannot exceed 50")]
    public string  Name { get; set; }

    [Required]
    [EmailAddress(ErrorMessage = "Email invalid")]
    [Display(Name="Office Email")]
    public string Email { get; set; }

    [Required]
    public Dept? Departament { get; set; }
    
    public IFormFile Photo { get; set; }
}
```

##### ./Mvc/Views/Shared_Layout.cshtml  
```csharp
<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <link href="~/lib/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <script src="~/lib/jquery/jquery.min.js"></script>
    <script src="~/lib/bootstrap/js/bootstrap.min.js"></script>
    <title>@ViewBag.Title</title>
</head>
<body>
    <header class="navbar navbar-expand-sm navbar-dark bg-dark">
        <nav class="container">
            <a class="navbar-brand" asp-action="index" asp-controller="home">
                <img src="~/images/employees.png" height="30" width="30" />
            </a>
            <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#collapsibleNavbar">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="collapsibleNavbar">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a asp-action="index" asp-controller="home" class="nav-link">List</a>
                    </li>
                    <li class="nav-item">
                        <a asp-action="create" asp-controller="home" class="nav-link">Create</a>
                    </li>
                </ul>
            </div>
        </nav>
    </header>
    <main class="container">
        @RenderBody()
    </main>
</body>
@if(IsSectionDefined("Scripts"))
{
    @RenderSection("Scripts", required: true)
}
</html>
```

### ./Mvc/Views/Home/Create.cshtml  
```csharp
@model EmployeeCreateViewModel

@{
    ViewBag.Title = "Create Employee";
}

<form enctype="multipart/form-data" asp-controller="Home" asp-action="Create" method="post">
    ...
    <div class="mb-3">
        <div class="input-group">
            <input asp-for="Photo" class="form-control custom-file-input" />
        </div>
    </div>
    ...
</form>
@section Scripts {
    <script>
        $(document).ready(function(){
            $('.custom-file-input').on("change", function(){
                var fileName =$(this).val().split("\\").pop();
                $(this).next('.custom-file-label').html(fileName);
            })
        });
    </script>
}
```


### HomeController.cs  
**IHostingEnvironment**  
```csharp
using Microsoft.AspNetCore.Mvc;

public class HomeController : Controller
{
    private readonly IEmployeeRepository _employeeRepository;
    private readonly Microsoft.AspNetCore.Hosting.IHostingEnvironment hostingEnvironment;

    public HomeController(IEmployeeRepository employeeRepository,
    Microsoft.AspNetCore.Hosting.IHostingEnvironment hostingEnvironment)
    {
        _employeeRepository = employeeRepository;
        this.hostingEnvironment = hostingEnvironment;
    }
```

**Create(EmployeeCreateViewModel model)**  
```csharp
    [HttpPost]
    public IActionResult Create(EmployeeCreateViewModel model)
    {
        if (ModelState.IsValid)
        {
            string uniqueFileName = null;
            if(model.Photo !=null)
            {
                string uploadsFolder = Path.Combine(hostingEnvironment.WebRootPath, "images");
                uniqueFileName = Guid.NewGuid().ToString() + "_" + model.Photo.FileName;
                string filePath = Path.Combine(uploadsFolder, uniqueFileName);
                model.Photo.CopyTo(new FileStream(filePath, FileMode.Create));
            }
            Employee newEmployee = new Employee
            {
                Name = model.Name,
                Email = model.Email,
                Departament = model.Departament,
                PhotoPath = uniqueFileName
            };

            _employeeRepository.Add(newEmployee);
            return RedirectToAction("details", new {id = newEmployee.Id});
        }
        return View();
    }
}
```



##### ./Mvc/Views/Home/Details.cshtml  
```csharp
@model HomeDetailsViewModel

@{
    ViewBag.Title = "Employee Details";
    var photoPath = "/Images/" + (Model.Employee.PhotoPath ?? "noimage.jpg");
}
<div class="row justify-content-center m-3">
    <div class="col-sm-8">
        <div class="card">
            <div class="card-header">
                <h1>@Model.Employee.Name</h1>
            </div>
            <div class="card-body text-center">
                <img class="card-img-top" src="@photoPath" />
```

##### ./Mvc/Views/Home/Index.cshtml  
```csharp
@model IEnumerable<Employee>

@{
    ViewBag.Title = "Employee List";
}

<div class="row row-cols-1 row-cols-md-3 g-4 mt-3">
    @foreach (var employee in Model)
    {
        var photoPath = "~/Images/" + (employee.PhotoPath ?? "noimage.jpg");
        <div class="col">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title">@employee.Name</h5>
                </div>
                <img class="card-img-top" src="@photoPath" asp-append-version="true" />
```



